
@page "/"
@using System.ComponentModel.DataAnnotations
@using QuickClipBlazor.Services
@inject NavigationManager NavigationManager
@inject SessionHolder SessionHolder

<EditForm Model="@ArtistQuery" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <InputText id="name" @bind-Value="@ArtistQuery" />

    <button type="submit">Submit</button>
</EditForm>

@foreach (var artist in ArtistResults)
{
    <button @onclick="() => SelectArtist(artist)">@artist.Name</button>
    <br>
}
@code
{
    [Required]
    public string ArtistQuery { get; set; } = "";

    public IEnumerable<DeezerArtist> ArtistResults { get; set; } = new List<DeezerArtist>();

    private async Task HandleValidSubmit()
    {
        ArtistResults = await DeezerService.SearchArtists(ArtistQuery);
    }

    private void SelectArtist(DeezerArtist artist)
    {
        SessionHolder.Session = new GameSession();
        NavigationManager.NavigateTo($"game/{artist.Id}");
    }
}
